---
import Heading from '../../../components/Heading.astro';
import { Button } from '../../../components/ui/button';
import RedLayout from '../../../layouts/RedLayout.astro';
import type { PostResponse } from '../../../types/post'; // Import the PostResponse type

// Extract the post ID from the URL
const postId = Astro.url.pathname.split('/').pop();

// Fetch the existing post data with proper typing
let post: PostResponse | null = null;

try {
  const res = await fetch(`http://localhost:3000/api/v1/post/${postId}`);
  if (res.ok) {
    const response = await res.json();
    if (response.code === 200 && response.status === 'OK') {
      post = response.data;
    }
  }
} catch (error) {
  console.error('Error fetching the post:', error);
}
---

<RedLayout title="View Post">
  <div slot="main" class="main-slot">
    <Heading tagName="h1" size="h4" classes="neue76"> VIEW POST </Heading>

    <a href="/posts">
      <Button variant="outline"> Back to Posts </Button>
    </a>

    {post ? (
      <div class="post-details mt-6 p-6 rounded-md border bg-white">
        <h2 class="text-2xl font-bold mb-2">{post.title}</h2>
        <h3 class="text-xl text-gray-600 mb-4">
          {post.sub_title || 'No subtitle provided'}
        </h3>

        <div class="mb-4">
          <strong>Published:</strong> {post.published ? 'Yes' : 'No'}
        </div>

        <div class="mb-4">
          <strong>Description:</strong>
          <p class="mt-1">{post.description}</p>
        </div>

        <a href={`/posts/edit/${post.id}`}>
          <Button variant="outline">Edit Post</Button>
        </a>
      </div>
    ) : (
      <p class="text-red-500 mt-6">Post not found or unable to load data.</p>
    )}
  </div>
</RedLayout>
